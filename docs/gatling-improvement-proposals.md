# Gatling 부하 테스트 개선 제안서

> 작성일: 2025-01-28  
> 목적: 실제 온라인 시험 환경을 정확히 시뮬레이션하기 위한 부하 테스트 고도화 방안

## 1. 현황 분석

### 1.1 구현 완료
- HTTP/WebSocket 혼합 프로토콜 처리
- 270명 동시 접속 테스트 (100% 성공률)
- 사용자별 랜덤 지연 (3~11초)
- 기본 시험 플로우 (인증→시스템체크→안내→시험→종료)

### 1.2 한계점
- 단순 시작/종료만 테스트
- 실제 문제 풀이 과정 없음
- 네트워크 장애 대응 테스트 부재
- 획일적인 사용자 행동 패턴

## 2. 핵심 개선 방안

### 2.1 실제 시험 시뮬레이션

#### 문제 단위 진행 관리
**AS-IS**
```
TEST_0 시작 → TEST_0 종료
```

**TO-BE**
```
문제1 진입 → 문제1 답변 → 저장 → 문제2 진입 → ... → 문제50 완료
```

#### 구현 세부사항
- 50개 문제 각각에 대한 상태 추적
- 문제별 소요시간: 정규분포 N(90초, σ=30초)
- 문제 난이도별 가중치 적용
- 답안 임시저장 → 최종제출 플로우

### 2.2 답안 처리 로직

#### 답안 저장 트리거
1. **자동 저장**: 30초마다
2. **수동 저장**: 사용자 저장 버튼 클릭
3. **이동 저장**: 다른 문제로 이동 시
4. **포커스 저장**: 브라우저 포커스 잃을 때

#### 답안 데이터 모델
```json
{
  "questionId": 15,
  "questionType": "multiple_choice",
  "answer": {
    "selected": [2, 4],  // 복수 정답
    "text": null,
    "confidence": 0.8
  },
  "metadata": {
    "timeSpent": 125,
    "revisionCount": 2,
    "lastModified": "2025-01-28T14:30:25.123Z"
  }
}
```

### 2.3 사용자 페르소나 정의

| 페르소나 | 비율 | 행동 특성 | 구현 포인트 |
|---------|------|-----------|------------|
| **스피드러너** | 15% | • 문제당 30초<br>• 순차 진행<br>• 검토 없음 | 빠른 클릭, 짧은 pause |
| **표준형** | 50% | • 문제당 90초<br>• 순차 진행<br>• 일부 검토 | 기본 시나리오 |
| **전략형** | 20% | • 쉬운 문제 먼저<br>• 어려운 문제 나중<br>• 2회 순회 | 조건부 분기, 문제 스킵 |
| **완벽주의자** | 10% | • 문제당 150초<br>• 모든 문제 검토<br>• 답안 수정 빈번 | 긴 pause, 반복 접근 |
| **포기자** | 5% | • 10~20문제만 풀이<br>• 중도 이탈 | 조기 종료 시나리오 |

### 2.4 동적 부하 패턴

#### 시간대별 접속 패턴
```
08:50 - 09:00: 200명 대기 → 접속 시도
09:00 - 09:05: 500명 동시 접속 (피크)
09:05 - 09:50: 안정 상태 유지
09:50 - 10:00: 제출 러시 (300명 동시 제출)
```

#### 구현 방법
```scala
// Gatling 코드 예시 구조
setUp(
  // 대기 단계
  waitingUsers.inject(
    nothingFor(10.minutes),
    rampUsers(200).during(10.minutes)
  ),
  // 피크 단계
  rushUsers.inject(
    atOnceUsers(500)
  ),
  // 종료 러시
  submissionRush.inject(
    nothingFor(50.minutes),
    rampUsers(300).during(5.minutes)
  )
)
```

### 2.5 장애 시나리오

#### 네트워크 불안정
- **일시적 끊김**: 5초 이내 자동 재연결
- **장기 끊김**: 30초 이상, 수동 재접속
- **간헐적 끊김**: 5분마다 1초씩 끊김

#### WebSocket 재연결 로직
```
1. 연결 끊김 감지
2. 지수 백오프: 1초 → 2초 → 4초 → 8초
3. 최대 5회 재시도
4. 실패 시 HTTP 폴백
```

### 2.6 부하 집중 포인트

#### 주요 병목 구간
1. **시험 시작**: 09:00 동시 접속
2. **자동 저장**: 30초 간격 동기화
3. **문제 이동**: 페이지 전환 부하
4. **시험 종료**: 09:55~10:00 제출 폭주

#### 측정 지표
- 응답시간 P50, P95, P99
- 처리량 (TPS)
- 에러율
- WebSocket 연결 유지율

## 3. 구현 계획

### 3.1 단계별 접근

**1단계 (1주차)**
- 문제별 상태 관리 구현
- 답안 저장 메시지 추가
- 기본 페르소나 2종 구현

**2단계 (2주차)**
- 5종 페르소나 완성
- 동적 부하 패턴 적용
- 재연결 시나리오 추가

**3단계 (3주차)**
- 통합 시나리오 구성
- 1000명 규모 테스트
- 성능 분석 및 튜닝

### 3.2 필요 리소스

#### 데이터 준비
- 50문제 세트 (JSON)
- 10,000명 테스트 계정
- 답안 패턴 데이터셋

#### 인프라
- Gatling 클러스터 (분산 테스트)
- 모니터링: Grafana + Prometheus
- 로그 분석: ELK Stack

### 3.3 검증 기준

#### 성능 목표
- 동시 접속: 1,000명
- 응답시간: P95 < 2초
- 에러율: < 0.1%
- 처리량: > 500 TPS

#### 안정성 목표
- 재연결 성공률: > 99%
- 데이터 정합성: 100%
- 장애 복구시간: < 10초

## 4. 기대 효과

### 4.1 리스크 감소
- 운영 중 장애 70% 감소
- 피크 시간 대응력 3배 향상
- 사용자 불만 50% 감소

### 4.2 비용 절감
- 조기 버그 발견으로 수정 비용 80% 절감
- 과도한 인프라 투자 방지
- 운영 인력 부담 감소

### 4.3 품질 향상
- 테스트 커버리지: 40% → 85%
- 실제 환경 재현도: 30% → 90%
- 성능 예측 정확도: 60% → 95%

## 5. 주요 리스크 및 대응

| 리스크 | 발생확률 | 영향도 | 대응방안 |
|--------|---------|--------|----------|
| 테스트 데이터 부족 | 중 | 상 | 실제 로그 기반 데이터 생성 |
| 인프라 한계 | 중 | 중 | 클라우드 리소스 활용 |
| 시나리오 복잡도 | 상 | 중 | 단계별 구현, 모듈화 |
| 일정 지연 | 중 | 상 | 핵심 기능 우선 구현 |

## 6. 참고 사항

### 6.1 기존 자산 활용
- Node.js 테스트: `multi-user-performance-test.js`
- 메시지 구조: Worker 서비스 스펙
- 데이터베이스: 실제 테이블 구조

### 6.2 협업 필요 부서
- **개발팀**: 시나리오 구현
- **QA팀**: 테스트 케이스 검증
- **인프라팀**: 환경 구축
- **운영팀**: 실사용 패턴 제공

### 6.3 향후 확장 고려
- AI 기반 이상 탐지
- 실시간 부하 조절
- 카오스 엔지니어링 통합

---

*문서 버전: 1.0*  
*다음 검토일: 2025-02-15*